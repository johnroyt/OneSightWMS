<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warehouse Management System</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app-container" id="app"></div>
    
    <script src="js/main.js"></script>
    <script>
        // Custom sidebar generator that includes Purchase Orders
        function generateCustomSidebar(activePage) {
            // Map old active pages to new ones for backward compatibility
            if (activePage === 'Transfers') {
                activePage = 'Orders';
            }
            
            return `
                <aside class="sidebar">
                    <div class="logo">
                        <div class="logo-icon"></div>
                        <span class="logo-text">WMS</span>
                    </div>
                    
                    <nav class="nav-section">
                        <div class="nav-section-title">Main</div>
                        <a href="javascript:void(0)" data-page="Dashboard" class="nav-item ${activePage === 'Dashboard' ? 'active' : ''}">
                            <div class="nav-icon">📊</div>
                            Dashboard
                        </a>
                        <a href="javascript:void(0)" data-page="Purchase Orders" class="nav-item ${activePage === 'Purchase Orders' ? 'active' : ''}">
                            <div class="nav-icon">📋</div>
                            Purchase Orders
                        </a>
                        <a href="javascript:void(0)" data-page="Orders" class="nav-item ${activePage === 'Orders' ? 'active' : ''}">
                            <div class="nav-icon">📝</div>
                            Orders & Transfers
                        </a>
                        <a href="javascript:void(0)" data-page="Inventory" class="nav-item ${activePage === 'Inventory' ? 'active' : ''}">
                            <div class="nav-icon">📦</div>
                            Inventory
                        </a>
                        <a href="javascript:void(0)" data-page="Shipments" class="nav-item ${activePage === 'Shipments' ? 'active' : ''}">
                            <div class="nav-icon">🚚</div>
                            Shipments
                        </a>
                        <a href="javascript:void(0)" data-page="Usage" class="nav-item ${activePage === 'Usage' ? 'active' : ''}">
                            <div class="nav-icon">👓</div>
                            Usage
                        </a>
                        <a href="javascript:void(0)" data-page="Usage" class="nav-item ${activePage === 'Special Project Requests' ? 'active' : ''}">
                            <div class="nav-icon">🛠️</div>
                            Special Requests
                        </a>
                    </nav>
                    
                    <nav class="nav-section">
                        <div class="nav-section-title">Management</div>
                        <a href="javascript:void(0)" data-page="Clinics & Events" class="nav-item ${activePage === 'Clinics & Events' ? 'active' : ''}">
                            <div class="nav-icon">🏥</div>
                            Clinics & Events
                        </a>
                        <!-- Add data-page to other nav items too -->
                    </nav>
                    
                    <div class="user-profile">
                        <div class="user-avatar">JD</div>
                        <div class="user-info">
                            <div class="user-name">John Doe</div>
                            <div class="user-role">Warehouse Manager</div>
                        </div>
                    </div>
                </aside>
            `;
        }

        // Override the navigateTo function to handle Purchase Orders
        function customNavigateTo(page) {
            const routes = {
                'Dashboard': '/index.html',
                'Purchase Orders': '/pages/purchase-orders/index.html',
                'Orders': '/pages/orders/index.html',
                'Inventory': '/pages/inventory/index.html',
                'Shipments': '/pages/shipments/index.html',
                'Usage': '/pages/usage/index.html',
                'Special Project Requests': '/pages/usage/index.html',
                'Clinics & Events': '/pages/clinics/index.html'
            };
            
            if (routes[page]) {
                // Using absolute path with leading slash
                window.location.href = routes[page];
            } else {
                console.error('No route found for:', page);
            }
        }

        // Generate the page structure
        document.addEventListener('DOMContentLoaded', function() {
            const app = document.getElementById('app');
            app.innerHTML = `
                ${generateCustomSidebar('Dashboard')}
                <div class="main-wrapper">
                    ${generateHeader('Dashboard')}
                    <main class="main-content">
                        <!-- Dashboard Stats - Caspio DataPage -->
                        <div class="datapage-container" id="dashboard-stats-datapage">
                            
                        </div>
                        
                        <!-- Inventory Snapshot & Reorder Alerts Row -->
                        <div class="dashboard-grid">
                            <!-- Inventory Snapshot -->
                            <div class="inventory-card">
                                <div class="card-header">
                                    <h2 class="card-title">Inventory Snapshot</h2>
                                    <a href="#" style="color: #4c6ef5; font-size: 0.875rem;">View Details →</a>
                                </div>
                                <div class="location-inventory">
                                    <span class="location-name">ROC Main Warehouse</span>
                                    <span class="location-qty">12,450 units</span>
                                </div>
                                <div class="location-inventory">
                                    <span class="location-name">Pod - Downtown Clinic</span>
                                    <span class="location-qty">850 units</span>
                                </div>
                                <div class="location-inventory">
                                    <span class="location-name">Pod - Westside Clinic</span>
                                    <span class="location-qty">625 units</span>
                                </div>
                                <div class="location-inventory">
                                    <span class="location-name">Sale-for-Sight Events</span>
                                    <span class="location-qty">320 units</span>
                                </div>
                            </div>
                            
                            <!-- Reorder Alerts -->
                            <div class="alert-card">
                                <div class="card-header">
                                    <h2 class="card-title">SKUs Below Reorder Point</h2>
                                    <button class="reorder-btn">Create PO for All</button>
                                </div>
                                <ul class="alert-list">
                                    <li class="alert-item">
                                        <span>SKU-1234: Lens Solution</span>
                                        <button class="reorder-btn">Create PO</button>
                                    </li>
                                    <li class="alert-item">
                                        <span>SKU-5678: Contact Lenses A</span>
                                        <button class="reorder-btn">Create PO</button>
                                    </li>
                                    <li class="alert-item">
                                        <span>SKU-9012: Eye Drops</span>
                                        <button class="reorder-btn">Create PO</button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Transfer Orders Section -->
                        <div class="full-width-section">
                            <div class="tabs">
                                <div class="tab active" onclick="switchTab(event, 'pending-transfers')">Pending Transfers</div>
                                <div class="tab" onclick="switchTab(event, 'incoming-returns')">Incoming Returns</div>
                            </div>
                            
                            <div id="pending-transfers" class="tab-content active">
                                <div class="datapage-container">
                                    <!-- Pending Transfers (ROC → Pod) DataPage -->
                                    <p>Pending Transfers DataPage will be embedded here</p>
                                </div>
                            </div>
                            
                            <div id="incoming-returns" class="tab-content">
                                <div class="datapage-container">
                                    <!-- Incoming Returns (Pod → ROC) DataPage -->
                                    <p>Incoming Returns DataPage will be embedded here</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Activity -->
                        <div class="full-width-section">
                            <div class="card-header">
                                <h2 class="card-title">Recent Clinic Usage</h2>
                                <button class="create-po-btn" style="background: #38a169;">+ Log Usage</button>
                            </div>
                            
                            <div class="datapage-container">
                                <!-- Clinic Consumption DataPage -->
                                <p>Recent Clinic Usage DataPage will be embedded here</p>
                            </div>
                        </div>
                    </main>
                </div>
            `;

            // Override the default navigation function
            window.navigateTo = customNavigateTo;

            // Setup click handlers for new navigation
            document.addEventListener('click', function(e) {
                const navItem = e.target.closest('.nav-item');
                
                if (navItem) {
                    e.preventDefault();
                    
                    // Always use data-page attribute
                    const pageName = navItem.getAttribute('data-page');
                    
                    if (pageName) {
                        console.log('Page name from data attribute:', pageName);
                        customNavigateTo(pageName);
                    } else {
                        console.error('No data-page attribute found');
                    }
                }
            });
        });
    </script>
</body>
</html>